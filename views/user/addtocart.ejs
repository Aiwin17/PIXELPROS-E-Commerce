<%- include('../partials/user-header')%>
  <section class="breadcrumb breadcrumb_bg">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="breadcrumb_iner">
            <div class="breadcrumb_iner_item">
              <h2>Cart Products</h2>
              <p>Home <span>-</span>Cart Products</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- breadcrumb start-->

  <!--================Cart Area =================-->
  <section class="cart_area padding_top">
    <div class="container">
      <div class="cart_inner">
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">Product</th>
                <th scope="col">Price</th>
                <th scope="col">Quantity</th>
                <th scope="col">Action</th>
              </tr>
            </thead>
            <tbody>
              <% products.forEach(product=> { %>
              <tr>
                
                  <td>
                    <div class="media">
                      <div class="d-flex">
                        <img style="width: 100px;" src="/images/<%= product.product.image[0] %>" alt="" />
                      </div>
                      <div class="media-body">
                        <p>
                          <%= product.product.description %>
                        </p>
                      </div>
                    </div>
                  </td>
                  <td>
                    <h5>
                      <%= product.product.price %>
                    </h5>
                  </td>
                  <td>
                    
                    <div class="product_count">
                      <!-- <span class="input-number-decrement"> <i class="ti-angle-down"></i></span>
                  <input class="input-number" type="text" value="<%#= product.product[0].quantity %>" min="0" max="10">
                  <span class="input-number-increment"> <i class="ti-angle-up"></i></span> -->
                      <button class="cart-item-count mr-3"
                        onclick="changeQuantity('<%= product._id %>','<%= product.product._id %>','<%= user._id %>',-1)">-</button>
                      <span id="<%=  product.product._id %>">
                        <%= product.quantity %>
                      </span>
                      <button class="cart-item-count ml-3"
                        onclick="changeQuantity('<%= product._id %>','<%= product.product._id %>','<%= user._id %>',1)">+</button>
                    </div>
                  </td>
                  <td>
                    <button class="btn"><i class="fas fa-trash"></i></button>
                  </td>
                 
              </tr>
              <% }) %>
              <tr class="shipping_area">
              <td></td>
              <td></td>
              <td>
                <% if (total) { %>
                  <h5 class="" style="text-align: right;">Subtotal: <span id="total"><%= total %></span></h5>
                <% } else { %>
                  <!-- <h4 class="ml-5">Total Rs.<span id="total1">0</span></h4> -->
                <% } %>
              </td>
              <!-- <td>
                <div class="shipping_box">
                  <ul class="list">
                    <li>
                      <a href="#">Flat Rate: $5.00</a>
                    </li>
                    <li>
                      <a href="#">Free Shipping</a>
                    </li>
                    <li>
                      <a href="#">Flat Rate: $10.00</a>
                    </li>
                    <li class="active">
                      <a href="#">Local Delivery: $2.00</a>
                    </li>
                  </ul>
                  <h6>
                    Calculate Shipping
                    <i class="fa fa-caret-down" aria-hidden="true"></i>
                  </h6>
                </div>
              </td> -->
            </tr>
            </tbody>
          </table>
          <div class="checkout float-right">
            <a class="btn_1" href="/product-list">Continue Shopping</a>
            <a class="btn_1 checkout_btn_1" href="/place-order">Proceed to checkout</a>
          </div>
        </div>
      </div>
  </section>
  <!--================End Cart Area =================-->


  <script>
    function changeQuantity(cartId, proId, userId, count) {

      let quantity = parseInt(document.getElementById(proId).innerHTML)
      count = parseInt(count)

      $.ajax({
        url: '/change-product-quantity',
        data: {
          user: userId,
          cart: cartId,
          product: proId,
          count: count,
          quantity: quantity
        },
        method: 'post',
        success: (response) => {
          if (response.removeProduct) {
            alert("Product Removed from the cart")
            location.reload()
          } else {
            document.getElementById(proId).innerHTML = quantity + count
            document.getElementById('total').innerHTML = response.total
          }
        }
      })
    }
  </script>

  <!--::footer_part start::-->
  <%- include('../partials/user-footer')%>